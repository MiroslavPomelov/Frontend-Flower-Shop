# Развертывание Flower Shop на Timeweb

## Подготовка проекта

1. Убедитесь, что все изменения закоммичены в Git
2. Проверьте, что Dockerfile и .dockerignore находятся в корне проекта
3. Убедитесь, что в next.config.js НЕТ `output: 'standalone'`

## Настройка на Timeweb

### 1. Создание Docker-контейнера
- Войдите в панель управления Timeweb
- Перейдите в раздел "Контейнеры" → "Создать контейнер"
- Выберите "Docker" как тип контейнера

### 2. Настройка контейнера
- **Имя**: flower-shop
- **Образ**: Укажите путь к вашему Docker образу или используйте автоматическую сборку
- **Порт**: 3000
- **Переменные окружения**:
  ```
  NODE_ENV=production
  PORT=3000
  HOSTNAME=0.0.0.0
  ```

### 3. Автоматическая сборка (рекомендуется)
- Подключите ваш Git репозиторий
- Укажите ветку (обычно main или master)
- **ВАЖНО**: В контексте сборки укажите `flower-shop/`
- Установите команду сборки: `docker build -t flower-shop .`
- Установите команду запуска: `docker run -p 3000:3000 flower-shop`

### 4. Ручная сборка
Если используете ручную сборку:
```bash
# В терминале Timeweb или локально
cd flower-shop
docker build -t flower-shop .
docker push your-registry/flower-shop:latest
```

## Проверка развертывания

1. После успешной сборки контейнер должен запуститься
2. Проверьте логи на наличие ошибок: `docker logs flower-shop`
3. Откройте приложение по адресу: `http://your-domain:3000`

## Возможные проблемы и решения

### Ошибка "Could not read package.json"
- Убедитесь, что Dockerfile находится в корне проекта (там же, где package.json)
- Проверьте, что .dockerignore не исключает package.json
- **ВАЖНО**: В Timeweb укажите контекст сборки `flower-shop/`

### Ошибка сборки Next.js
- Убедитесь, что в next.config.js НЕТ `output: 'standalone'`
- Проверьте, что все зависимости указаны в package.json
- Используйте стандартный подход с `npm start`

### Проблемы с портами
- Проверьте, что порт 3000 открыт в настройках Timeweb
- Убедитесь, что в Dockerfile указан `EXPOSE 3000`

### Приложение не запускается
- Проверьте логи: `docker logs flower-shop`
- Убедитесь, что используется `CMD ["npm", "start"]`
- Проверьте переменные окружения

## Локальное тестирование

Перед деплоем протестируйте локально:
```bash
# Windows
test-docker.bat

# Linux/Mac
./build-docker.sh

# Или вручную
docker build -t flower-shop .
docker run -p 3000:3000 flower-shop
```

## Мониторинг

- Регулярно проверяйте логи контейнера
- Мониторьте использование ресурсов
- Настройте автоматический перезапуск при сбоях

## Обновление приложения

При обновлении кода:
1. Запустите новую сборку в Timeweb
2. Проверьте работоспособность
3. При необходимости откатитесь к предыдущей версии
